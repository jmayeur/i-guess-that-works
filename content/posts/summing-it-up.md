+++
author = 'Jeff Mayeur'
title = 'Summing it up'
description = "A brief dive into Hugo's structure and it's templates"
tags = ['Hugo', 'DSL', 'Templates', 'Go', 'Hugo Summaries']
date = 2024-05-19T20:00:00-07:00
draft = false
+++

# Sum it up, and be quick.

## The Basics

- [Go HTML Template](https://pkg.go.dev/html/template) - This is the basic language that is used to inject dynamic content and logic into an otherwise static HTML Document
- [Hugo Templates](https://gohugo.io/templates/) - Hugo uses the [Go HTML Template](https://pkg.go.dev/html/template) to structure the a site, from the home page, to sub pages, to navigation, all of the facets of a Huge Site are driven through these templates
- [Hugo Clarity's Excerpt](https://github.com/chipzoller/hugo-clarity/blob/master/layouts/partials/excerpt.html) - This is the template I'm interested in, it renders the "Summary" that shows up on the root of this blog.

## A Summary Example
There are definitely times when I will want to explicitly write the summary for a given post, but I do like automated things. The problem for me was that the autogenerated summary was pulling in the first few words from the post including the titles. The summary for the [It Starts Here](https://iguessthatworks.com/posts/it-starts-here/) post reads "Hi, I'm Jeff What This site exists for me to collect...". You can read past the titles, but I wasn't super pleased with it. Something had to be done.

![Summary of the first post - It Starts Here - before the update](/images/summing-it-up/summary_original.png)

The summary is generated from the content of the [It Starts Here](https://iguessthatworks.com/posts/it-starts-here/) post. It's a great feature of Hugo that it can [autogenerate a quick summary](https://gohugo.io/content-management/summaries/), and display it in a list. This gives a quick way to surface content and doesn't require the author to create a separate abstract or summary.


## Enough to be dangerous
I'm not familiar with the [Go HTML Template](https://pkg.go.dev/html/template) format. I've used templating languages before like [Handlebars](https://handlebarsjs.com) or [Mustache](https://mustache.github.io), so I'm familiar with the concept, but not expert enough to start running on my own. I needed some help

### Step 1
Google is my friend when it comes to coding, although [Github Copilot](https://github.com/features/copilot) is slowly supplanting it. In this case because I didn't even know where to start. I [searched](https://www.google.com/search?q=Hugo+summary+template) and stumpled across this [blog entry](https://yihui.org/en/2017/08/hugo-post-summary/) from [Yihui Xie](https://yihui.org/en/about/). It gave me the first bits I needed, spefically this line, which would use a regex to grab the contents of the first paragraph.
```
{{ $.Scratch.Set "summary" ((delimit (findRE "(?s)(<p.*?>.*?</p>)" .Content) "[&hellip;] ") | plainify | truncate (default 200 $.Site.Params.summary_length) (default " &hellip;" $.Site.Params.text.truncated ) | replaceRE "&amp;" "&" | safeHTML) }}
```

### Step 2
I needed ot figure out where to add this magic bit of code.  I see that in the [blog](https://yihui.org/en/2017/08/hugo-post-summary/), Yihui Xie indicates that I need to update the `default/list.html`. Looking at what I've got in the [Clarity Theme](https://github.com/chipzoller/hugo-clarity/blob/master/layouts/_default/list.html), I see the code block below. 

The first thing I tried was to just paste the code, but that as expected didn't do what I was hoping. I needed to spend some time reading the templates. The first thing I noticed was the line `- partial "archive"`. I saw there as a `partials` folrder, and inside that there was an [archive.html](https://github.com/chipzoller/hugo-clarity/blob/master/layouts/partials/archive.html) file. When I read that template I saw there was the `- partial "excerpt"` line and a cooresponding [excerpt.html](https://github.com/chipzoller/hugo-clarity/blob/master/layouts/partials/excerpt.html) file.  When I examined that file, I saw something similar to what was in the blog post. I tried copy-paste-victory, but again it didn't work.

```
// list.html
{{ define "main" }}
  {{- partial "archive" . }}
{{ end }}

// excerpt.html snippet
{{- $summary := truncate 320 .Summary }}
{{- if .Params.summary }}
  {{- $summary = .Params.summary }}
{{- else if .Params.abstract }}
  {{ $summary = .Params.abstract }}
{{- end }}
{{ if not ( strings.Contains $summary "<p>" ) }}
  <p>{{ $summary | markdownify }}</p>
{{ else }}
  {{ $summary | markdownify }}
{{ end }}
```

### Step Win
Once again I needed to read the template, and think about what it was doing.  I saw the line `{{- $summary := truncate 320 .Summary }}` and realized it was setting a `$summary` variable with the truncated value of the `.Summary` This looked a lot like the work the `{{ $.Scratch.Set "summary" ...` line was trying to do. So I took the blog line, and merged it with the line in the [excerpt.html](https://github.com/chipzoller/hugo-clarity/blob/master/layouts/partials/excerpt.html) file to create the line below - and Win. I now have an autogenerated Sumamry that is based on the first paragraph of a post. So much nicer.
```
 {{- $summary := ((delimit (findRE "(?s)(<p.*?>.*?</p>)" .Content) "[&hellip;] ") | plainify | truncate (default 200 $.Site.Params.summary_length) (default " &hellip;" $.Site.Params.text.truncated ) | replaceRE "&amp;" "&" | safeHTML) }}
```

![Summary of the first post - It Starts Here - after the update](/images/summing-it-up/summary.png)

### Step Override
Thankfully Hugo makes it pretty simple to [override a theme](https://bwaycer.github.io/hugo_tutorial.hugo/themes/customizing/).  I created a local `/layouts/partials/excerpt.html` and there you have it - a clean summary.

## Wrap
In this case it definitely helped to have some experience with templating, it let me walk the code a little easier, but really it's mostly about finding other examples, and just tinkering. There's a good chance, that what I've done isn't correct, but that's okay, I'm learning, and part of that process is just trying things. In this case most of what I tried didn't work. When I got stuck I read the code, thought about it, and came up with a new switch flip. So far I'm pretty happy with the outcome. 

Even in my professional career, it's not uncommon for me to just try my way to a conclusion. I do have the advantage of having competent peers that can correct me, but it's definitely a viable approach to solving the problems you encounter.

### QOTD
“I'm smart enough to know that I'm dumb.”
― Richard Feynman